---
title: "Homework vi"
author: "Sunakshi Sharma"
date: "2018-10-12"
header-includes:
- \usepackage{booktabs}
- \usepackage{longtable}
- \usepackage{array}
- \usepackage{multirow}
- \usepackage[table]{xcolor}
- \usepackage{wrapfig}
- \usepackage{float}
- \usepackage{colortbl}
- \usepackage{pdflscape}
- \usepackage{tabu}
- \usepackage{threeparttable}
- \usepackage{threeparttablex}
- \usepackage[normalem]{ulem}
- \usepackage{makecell}
output:
  pdf_document: default
  html_document: default
---

\newpage
\tableofcontents 

\newpage

# NYC 311 Data 

The data represents the 311 complaints registered by the citizens. It basically provides all the information regarding the complaint like where did the incident take place, the exact address, latitude, longitude, type of address etc. At this point we are cleaning the data and removing the unnecessary rows or columns from it. Also we are loading another dataset of NYC collision data having something common with our previous dataset and perform the appropriate cleaning in the new data.


```{r, include=FALSE}
# Load all the packages

# Reference
# http://www.vikram-baliga.com/blog/2015/7/19/a-hassle-free-way-to-verify-that-r-packages-are-installed-and-loaded
packages = c("knitr","data.table","tidyverse","dataMeta","ggrepel","tidyverse","wordcloud", "dplyr", "tidyr", "RColorBrewer", "cowplot", "mice", "VIM", "ggthemes", "kableExtra", "ggthemes", "scales")

#use this function to check if each package is on the local machine
#if a package is installed, it will be loaded
#if any are not, the missing package(s) will be installed and loaded
package.check <- lapply(packages, FUN = function(x) {
    if (!require(x, character.only = TRUE)) {
        install.packages(x, dependencies = TRUE)
        library(x, character.only = TRUE)
    }
})
#verify they are loaded
search()
```

```{r}
opts_chunk$set(tidy.opts=list(width.cutoff=60),tidy=TRUE)
```

## Data loading, cleaning and transformation for analysis

### Loading the CSV file data-frame

```{r}
nyc.df <- fread(file="./311_Service_Requests_from_2010_to_Present.csv", na.strings=c("","NA"), header=TRUE, sep=",")
```


```{r}
kable(head(nyc.df[, 1:9]), "latex", booktabs = T) %>%
  kable_styling(latex_options = c("striped", "scale_down", "HOLD_position"))
kable(head(nyc.df[, 10:18]), "latex", booktabs = T) %>%
  kable_styling(latex_options = c("striped", "scale_down", "HOLD_position"))
kable(head(nyc.df[, 19:29]), "latex", booktabs = T) %>%
  kable_styling(latex_options = c("striped", "scale_down", "HOLD_position"))
kable(head(nyc.df[, 30:38]), "latex", booktabs = T) %>%
  kable_styling(latex_options = c("striped", "scale_down", "HOLD_position"))
kable(head(nyc.df[, 39:48]), "latex", booktabs = T) %>%
  kable_styling(latex_options = c("striped", "scale_down", "HOLD_position"))
kable(head(nyc.df[, 49:52]), "latex", booktabs = T) %>%
  kable_styling(latex_options = c("striped", "scale_down", "HOLD_position"))
```
### Data Summary
```{r}
summary(nyc.df)
```


### Glimpse of data
```{r}
glimpse(nyc.df)
```

```{r}
colnames(nyc.df)
```

Lets first check whether there are duplicate rows based on the column Unique Key. We can see that in the original nyc.df data-frame there are 9124937 observations. Whereas when we find the length of column Unique Key based on how many unique rows there are, it comes to be around 9124915. Which means there are around  (9124937-9124915) = 22 Observations that are not unique. Removing them will provide us with unique rows!

```{r}
length(unique(nyc.df$`Unique Key`))
```

Removing observation with duplicate Unique Key. This will remove redundancy from the dataset. And we will be better able to understand it.

```{r}
nyc.df <- nyc.df[!duplicated(nyc.df$`Unique Key`),]
```

### Doing some analysis to better understand our data.

Here we are trying to find the colummns and their corresponding counts. We can see there are a few columns where there are a lot of empty, null and na values. We find out using this particular r code. if there is column which has a lot of empty, null or na values it will have less count and thus deems useless for our purpose.

```{r}
lapply(nyc.df, function(x) length(which(!is.na(x))))
```

### Working on Incident Zip

We can see from the analysis we did on overall data finding NA values, we found out that Incident Zip is the only column from one of many important columns having a lot on NA values. Whereas Agency and Borough does not have NA values. We will want to remove rows with NA values for Incident Zip. Lets remove these rows and then will dig further. 

```{r}
nyc.df <- nyc.df[!is.na(nyc.df$`Incident Zip`), ]
```

We can see after removing Incident Zip with NA values we are left with 8334994 observations.

## Understanding and tidying Borough

### Getting the summary

```{r}
summary(nyc.df$Borough)
```

### Getting glimpse

```{r}
glimpse(nyc.df$Borough)
```

### Looking at Boroughs to see unique values

```{r, eval=FALSE}
unique(nyc.df$Borough)
length(unique(nyc.df$Borough))
```

From above we can see that there are total 6 Boroughs, out of these unique 6, one is unspecified. The 'unspecified' might not be of much use to us for our exploratory data analysis. We will remove it.

### Removing rows where Borough is unspecified.

```{r}
nyc.df <- nyc.df[!(nyc.df$Borough == "Unspecified"), ]
```

### Lets run again and see if "Unspecified" Boroughs have been removed.

```{r}
unique(nyc.df$Borough)
length(unique(nyc.df$Borough))
```

We can see the "Unspecified" Boroughs have been removed from the data frame. Now we are left with 7507949 observations.

### Now converting Borough to Factor.

```{r}
nyc.df$Borough <- as.factor(nyc.df$Borough)
```

### Lets summarize and see whether the Boroughs have been converted to factors? 

```{r}
summary(nyc.df$Borough)
```


## Understanding and tidying Agency

### Getting the summary

```{r}
summary(nyc.df$Agency)
```

### Getting the glimpse

```{r}
glimpse(nyc.df$Agency)
```

### Looking at Agency to see unique values

```{r}
unique(nyc.df$Agency)
length(unique(nyc.df$Agency))
```

As can be seen there are 19 Agencies. There aren't any NA or random values. Agency looks like doesn't need much cleaning! Thankfully!!

### Now converting Agency to Factor too!

```{r}
nyc.df$Agency <- as.factor(nyc.df$Agency)
```

### Lets summarize and see whether the Agencies have been converted to factors? 

```{r}
summary(nyc.df$Agency)
```

## Understanding and tidying City

### Getting the summary

```{r}
summary(nyc.df$City)
```

### Getting the glimpse

```{r}
glimpse(nyc.df$City)
```

### Looking at City to see unique values

```{r}
unique(nyc.df$City)
length(unique(nyc.df$City))
```

### Removing NA values from City

```{r}
nyc.df <- nyc.df[!is.na(nyc.df$City), ]
```

### Converting all Cities to Uppercase. We see that there is no set way

```{r}
nyc.df$City <- toupper(nyc.df$City)
```

### Lets see how far we have reached

```{r}
unique(nyc.df$City)
length(unique(nyc.df$City))
```

We can see a lot of spelling errors like STATEN ISLAND is written as STATEN ISLANE. Also, there is are values like 000000, N/. These values need to be cleaned up, as they make no sense. We will proceed cleaning up the data.We are keeping Unknown value, as they could be of use for analytical purpose.

```{r}
nyc.df <- nyc.df[!(nyc.df$City == "000000" | nyc.df$City == "N/"), ]
```

Lets order the cities, to understand them better and further correct any issues with them.

```{r}
# Getting Staten Island, and replacing it
nyc.df$City <- sub("^STA.*AND$|^STA.*", "STATEN ISLAND", nyc.df$City)
```

```{r}
unique(nyc.df$City)
```

We can still see, "SATEN ISLAND" as our Regex could not match it. We can convert is manually. Not a good idea though! I hope there isnt a place like SATEN ISLAND!! Also, 

```{r}
nyc.df$City[nyc.df$City == "SATEN ISLAND"] <- "STATEN ISLAND"
```


```{r}
unique(nyc.df$City)
```

Now lets improve it further. We can see that people who are collecting data are not good at typing in correct spellings. Especially looking at QUEENS, I am flabbergasted at the variance of its spellings: "QNS QUENNS QUUENS QUEEENS QUENS"? Anyway, as a thoughtful and a diligent data anlyst, I will take it as a challenge and try to come up with a smart regex! We see all these words start with Q and end with S. Also, looking at the data above, there isnt any other place that starts with Q and ends with S, which further makes it easy for us to tackle the problem! But wait? What about QUEENS, N.Y.? This ends with a dot?

```{r}
nyc.df$City <- sub("^Q.*S$|^QU.*Y\\.", "QUEENS", nyc.df$City)
```

Running to see our changes!

```{r}
unique(nyc.df$City)
```

Wow! There is still QUEEN out there. But we will handle this manually

```{r}
nyc.df$City[nyc.df$City == "QUEEN"] <- "QUEENS"
```

```{r}
unique(nyc.df$City)
```

Looking carefully at the data, it looks like QUEENS has been resolved. Also, we see BRONX, BROOKLYN has a lot of spelling mistakes. JAMAICA and MANHATTAN on the other hand only has one mistake. We will resolve BRONX, BROOKLYN, MANHATTAN AND JAMAICA respectively.

```{r}
nyc.df$City <- sub("BRONXS|BONX|BRONX NY|BROX", "BRONX", nyc.df$City)
```

```{r}
nyc.df$City <- sub("^B.*N$", "BROOKLYN", nyc.df$City)
```

```{r}
nyc.df$City <- sub("^MAN.*N$", "MANHATTAN", nyc.df$City)
```

```{r}
nyc.df$City[nyc.df$City == "JAMICA"] <- "JAMAICA"
```

```{r}
nyc.df$City <- sub("^NE.*K$|^NEW.*Y", "NEW YORK", nyc.df$City)
```

Finally all the major cities have been improved as far spelling mistakes are concerned! Lets check how the dataframe looks like now!

```{r}
unique(nyc.df$City)
```

### Converting Dates to Date objects. This will allow us to better manipulate the date and time.

```{r}
nyc.df$`Created Date` = as.POSIXct(nyc.df$`Created Date`, format="%m/%d/%Y %I:%M:%S %p", tz="UTC")
nyc.df$`Closed Date` = as.POSIXct(nyc.df$`Closed Date`, format="%m/%d/%Y %I:%M:%S %p", tz="UTC")
```





## Data Exploration 

### We find the number of complaints by Borough. 

We can see that highest number of complaints were filed from Brooklyn.

```{r fig.align="center", fig.asp=0.8, fig.pos="H", fig.cap="Complaint by Borough"}
ggplot(data = nyc.df) +
  geom_bar(mapping = aes(x = nyc.df$Borough), fill="orange") + ylab("Count of Complaint") +xlab("Borough") + ggtitle("Complaint by Borough") 
```

### pie chart showing complaint by Status
```{r fig.align="center", fig.asp=0.8, fig.pos="H", fig.cap="Complaint by Status"}
counts_freqs_df <- data.frame(table(nyc.df$Borough))
counts_freqs_df %>%
arrange(desc(counts_freqs_df$Freq)) %>%
mutate(prop = percent(counts_freqs_df$Freq / sum(counts_freqs_df$Freq))) -> counts_freqs_df 

pie <- ggplot(counts_freqs_df, aes(x = "", y = counts_freqs_df$Freq, fill = fct_inorder(counts_freqs_df$Var1))) +
       geom_bar(width = 1, stat = "identity") +
       scale_y_continuous(labels=function(n){format(n, scientific = FALSE)}) +
       coord_polar("y", start = 0) +
       geom_label_repel(aes(label = prop), size=3, show.legend = F, nudge_y = 20) +
       guides(fill = guide_legend(title = "Boroughs")) + ylab("Frequency")
pie
```

### This shows top 20 agencies with respect to complaints! HPD, DOT and NYPD are doing a good job here! (Not really.)

```{r}
top_20_agencies_by_complaints <- data.frame(table(nyc.df$Agency))[order(-data.frame(table(nyc.df$Agency))$Freq),][1:20,]
kable(top_20_agencies_by_complaints, "latex", booktabs = T, caption = "Top 20 Agencies by complaint frequency") %>%
  kable_styling(latex_options = c("striped", "HOLD_position"))
```

Here we can see that which type of agency handles which type of complaints and can deduce the maximum number of complaints that falls into a particular agency. This is basically showing top 20 agencies handling maximum number of complaints.

```{r fig.align="center", fig.asp=0.8, fig.pos="H", fig.cap="Frequency of Complaints by Agency"}
ggplot(top_20_agencies_by_complaints, aes(x = reorder(top_20_agencies_by_complaints$Var1, -top_20_agencies_by_complaints$Freq), y = top_20_agencies_by_complaints$Freq)) +
         geom_bar(stat = "identity", fill="brown") +
         scale_y_continuous(labels=function(n){format(n, scientific = FALSE)}) +
         coord_flip() + xlab("Agency") + ylab("Frequency of Complaints by Agency") + ggtitle("Frequency of Complaints by Agency")
```


### We would now like to know the Complaint types. There are a total of 220 complaints.

```{r}
length(unique(nyc.df$`Complaint Type`))
```

### We will want to see the ticket status of these complaints. 

Here we are finding Status of complaints. We can see that there are a total of 9 unique statuses of complaints.

```{r}
unique(nyc.df$Status)
sprintf("Total Number of Status: %i ",length(unique(nyc.df$Status)))
```

Frequency of complaint tickets. Complaints Status Frequency can be seen by running this particular code chunk. We can see a lot of complaints have been closed. And a lot of them have been assigned and looked after. That is positive! But still there are around 835089 complaints that are 'Open'.

```{r}
kable(data.frame(table(nyc.df$Status)), "latex", booktabs = T, caption = "Complaints Status Frequency") %>%
  kable_styling(latex_options = c("striped", "HOLD_position"))
```

Now lets take a better look at visualizing Complaint Status. The diagram/plot will give us a better intuitive sense. Can be clearly seen what we described above.

```{r fig.align="center", fig.asp=0.8, fig.pos="H", fig.cap="Complaint Status"}
ggplot(data.frame(table(nyc.df$Status)), aes(x = reorder(data.frame(table(nyc.df$Status))$Var1, -data.frame(table(nyc.df$Status))$Freq), y = data.frame(table(nyc.df$Status))$Freq)) +
         geom_bar(stat = "identity", fill="blue") +
         scale_y_continuous(labels=function(n){format(n, scientific = FALSE)}) +
         coord_flip() + ylab("Count of Complaint status") + xlab("Status")+ ggtitle("Complaint Status")
```


### Lets find top 20 Complaints. Its fun!

```{r}
nyc.df.complaints.ordered <- data.frame(table(nyc.df$`Complaint Type`))[order(data.frame(table(nyc.df$`Complaint Type`))$Freq, decreasing = TRUE),]
top_20_complaints <- nyc.df.complaints.ordered[1:20,]
```


### Maximum complaint type

Can be seen complaints that were maximum were for 'Heating'. Obviously its east coast. Run this code if you don't believe.

```{r fig.align="center", fig.asp=0.8, fig.pos="H", fig.cap="Complaint Type Frequency"}
ggplot(top_20_complaints, aes(x = reorder(top_20_complaints$Var1, -top_20_complaints$Freq), y = top_20_complaints$Freq)) +
         geom_bar(stat = "identity", fill="red") +
         scale_y_continuous(labels=function(n){format(n, scientific = FALSE)}) +
         coord_flip() + xlab("Complaint Type") + ylab("Frequency") + ggtitle("Complaint Type Frequency")
```

Lets try to find out which complaints are most famous and prevalent, even though we can see from the above graph that Heating is the most sought after but it is more enticing to see that using a word cloud for our understanding. Visual treat is always better. And what this shows? Heating is a problem! East coast my friend. East Coast. I believe heating is not the problem, but winters are!

```{r message=FALSE, warning=FALSE, fig.cap="Wordcloud"}
nyc.df.complaints.ordered <- data.frame(table(nyc.df$`Complaint Type`))[order(data.frame(table(nyc.df$`Complaint Type`))$Freq, decreasing = TRUE),]
wordcloud(words = nyc.df.complaints.ordered$Var1, freq = nyc.df.complaints.ordered$Freq, min.freq = 1,
          max.words=200, random.order=FALSE, rot.per=0.35, 
          colors=brewer.pal(8, "Dark2"))
```


### Here we are trying to group by cities to find the complaints. 

Doing this makes us understand the data here more.

```{r}
Freqs <- nyc.df %>%
  group_by(nyc.df$City) %>%
  summarize(Freq = n())
kable(head(Freqs), "latex", booktabs = T, caption = "Cities grouped by complaint frequency") %>%
  kable_styling(latex_options = c("striped", "HOLD_position"))
```

Now analyzing the complaints by cities. And bummer, people in Brooklyn complain alot! Also, second spot is taken by New York City. Not surprising!! 

```{r}
Freqs.complaints_by_city <- Freqs[order(Freqs$Freq, decreasing = TRUE),]
Freqs.complaints_by_city
Freqs.complaints_by_city_top_20 <- Freqs.complaints_by_city[1:20, ]
Freqs.complaints_by_city_top_20
```

### It can be seen from top 20 cities complaining. Brooklyn is at number 1 spot! 

```{r fig.align="center", fig.asp=0.8, fig.pos="H", fig.cap="Top 20 Complaints"}
ggplot(Freqs.complaints_by_city_top_20, aes(x = reorder(Freqs.complaints_by_city_top_20$`nyc.df$City`, -Freqs.complaints_by_city_top_20$Freq), y = Freqs.complaints_by_city_top_20$Freq)) +
         geom_bar(stat = "identity") +
          scale_y_continuous(labels=function(n){format(n, scientific = FALSE)}) +
         coord_flip()+ ylab("Frequency") + xlab("City") + ggtitle("Top 20 Complaints")
```



### Getting the frequency of complaints by Borough and Complaints Type.

Grouping the data by Borough and Complaint type. Then arranging the data frame by Borough and Complaint Type. This will help us calculating the complaints by Borough and Complaints Type. This will provide a better insight. Further creating a new data-frame.


```{r}
# Group by Borough and Complaints type
newdf <- nyc.df %>% group_by(nyc.df$Borough, nyc.df$`Complaint Type`) %>% arrange(nyc.df$Borough, nyc.df$`Complaint Type`)
```


### Finding the frequency of complaints by Borough and Complaints Type.

```{r}
dat.new <- dcast(newdf, newdf$Borough ~ newdf$`Complaint Type`, fun.aggregate = length)
dat.new
```

Here we are trying to show the most famous complaints that we noticed on word cloud and their frequency for every Borough. It can be seen Heating complaint is most prevalent in BRONX whereas QUEENS has lot of complaints regarding street conditions, Water system, blocked driveway, street light condition. Looks like QUEENS has a lot of problems ! If you dont like potholes, choppy roads and flat tires you may want to steer clear of Queens! If you don't like winters you may want to avoid Brooklyn and Bronx and if you hate Traffic Jams, Traffic Signal Problems definitely avoid Brooklyn and Queens! Manhattan surprisingly does not have much problems, it is not suffering like Brooklyn, Queens and Bronx. Maybe because Manhattan is not as big as Brooklyn, Queens and Bronx? Maybe Manhattan has a better law and order? Lastly if you want to have peace of mind, you can get a house in Staten Island and click picturesque photos of New York skyline everyday. Until you get bored. Go on a free ferry ride and see liberty island. Yes. Its Staten Island! The best Borough overall (thats what stats tell).


```{r fig.align="center", fig.asp=0.8, fig.pos="H", fig.cap="Different complaints, different Boroughs"}
# building data frames to plot

heatdata <- data.frame(dat.new$`newdf$Borough`, dat.new$HEATING)
streetcond <- data.frame(dat.new$`newdf$Borough`, dat.new$`Street Condition`)
plumbdat <- data.frame(dat.new$`newdf$Borough`, dat.new$PLUMBING)
watersys <- data.frame(dat.new$`newdf$Borough`, dat.new$`Water System`)
streetlightcond <- data.frame(dat.new$`newdf$Borough`, dat.new$`Street Light Condition`)
blockeddriveway <- data.frame(dat.new$`newdf$Borough`, dat.new$`Blocked Driveway`)
trafficsignalcond <- data.frame(dat.new$`newdf$Borough`, dat.new$`Traffic Signal Condition`)
paintplaster <- data.frame(dat.new$`newdf$Borough`, dat.new$`PAINT - PLASTER`)

# building plots here 

heatplot <- ggplot(data = heatdata, aes(x=heatdata$dat.new..newdf.Borough., y=heatdata$dat.new.HEATING)) +
  geom_bar(stat = "identity", fill="blue") +
  theme(axis.text.x = element_text(size=8)) +
  scale_y_continuous(labels=function(n){format(n, scientific = FALSE)}) + ylab("Count of Complaint") +xlab("Borough") + ggtitle("Heating Complaint by Borough") 

streetcondplot <- ggplot(data = streetcond, aes(x=streetcond$dat.new..newdf.Borough., y=streetcond$dat.new..Street.Condition.)) +
  geom_bar(stat = "identity", fill="yellow") +
  theme(axis.text.x = element_text(size=8)) +
  scale_y_continuous(labels=function(n){format(n, scientific = FALSE)}) + ylab("Count of Complaint") +xlab("Borough") + ggtitle("Street Condition Complaint by Borough") 

plumbplot <- ggplot(data = plumbdat, aes(x=plumbdat$dat.new..newdf.Borough., y=plumbdat$dat.new.PLUMBING)) +
  geom_bar(stat = "identity", fill="red") +
  theme(axis.text.x = element_text(size=8)) +
  scale_y_continuous(labels=function(n){format(n, scientific = FALSE)}) + ylab("Count of Complaint") +xlab("Borough") + ggtitle("Plumbing Complaint by Borough") 

waterplot <- ggplot(data = watersys, aes(x=watersys$dat.new..newdf.Borough., y=watersys$dat.new..Water.System.)) +
  geom_bar(stat = "identity", fill="green") +
  theme(axis.text.x = element_text(size=8)) +
  scale_y_continuous(labels=function(n){format(n, scientific = FALSE)}) + ylab("Count of Complaint") +xlab("Borough") + ggtitle("Water System related Complaint by Borough") 

streetlightcondplot <- ggplot(data = streetlightcond, aes(x=streetlightcond$dat.new..newdf.Borough., y=streetlightcond$dat.new..Street.Light.Condition.)) +
  geom_bar(stat = "identity", fill="black") +
  theme(axis.text.x = element_text(size=8)) +
  scale_y_continuous(labels=function(n){format(n, scientific = FALSE)}) + ylab("Count of Complaint") +xlab("Borough") + ggtitle("Street Light condition related Complaint by Borough") 

blockeddrivewayplot <- ggplot(data = blockeddriveway, aes(x=blockeddriveway$dat.new..newdf.Borough., y=blockeddriveway$dat.new..Blocked.Driveway.)) +
  geom_bar(stat = "identity", fill="purple") +
  theme(axis.text.x = element_text(size=8)) +
  scale_y_continuous(labels=function(n){format(n, scientific = FALSE)}) + ylab("Count of Complaint") +xlab("Borough") + ggtitle("Blocked Drive Way Complaint by Borough") 

trafficsignalcondplot <- ggplot(data = trafficsignalcond, aes(x=trafficsignalcond$dat.new..newdf.Borough., y=trafficsignalcond$dat.new..Traffic.Signal.Condition.)) +
  geom_bar(stat = "identity", fill="grey") + 
  theme(axis.text.x = element_text(size=8)) +
  scale_y_continuous(labels=function(n){format(n, scientific = FALSE)}) + ylab("Count of Complaint") +xlab("Borough") + ggtitle("Traffic Signal Condition related Complaint by Borough") 

paintplasterplot <- ggplot(data = paintplaster, aes(x=paintplaster$dat.new..newdf.Borough., y=paintplaster$dat.new..PAINT...PLASTER.)) +
  geom_bar(stat = "identity", fill="pink") +
  theme(axis.text.x = element_text(size=8)) +
  scale_y_continuous(labels=function(n){format(n, scientific = FALSE)}) + ylab("Count of Complaint") +xlab("Borough") + ggtitle("Paint and Plaster related Complaint by Borough") 

# plotting the plots

heatplot
streetcondplot 
plumbplot
waterplot
streetlightcondplot
blockeddrivewayplot
trafficsignalcondplot
paintplasterplot
```

### Calculating closure time of complaints by Borough. 

Removing objects from the Global Environment. This will keep the workspace clean, free the memory. This will allow efficient and faster processing to carry forward other tasks.


```{r}
# Deleting Large Data Frames that are not required for analysis after this chunk so that our operations are fast. 
rm(list=c("newdf", "watersys", "waterplot", "Freqs", "Freqs.complaints_by_city_top_20", "Freqs.complaints_by_city", "blockeddriveway", "blockeddrivewayplot", "counts_freqs_df", "dat.new", "heatdata", "heatplot", "nyc.df.complaints.ordered", "paintplaster", "paintplasterplot", "pie", "plumbdat", "plumbplot", "streetcond", "streetcondplot", "streetlightcond", "streetlightcondplot", "top_20_complaints", "trafficsignalcond", "trafficsignalcondplot", "top_20_agencies_by_complaints"))
```


Getting the closure time by calculating the difference between the date on which complaint ticket was created and the date when complaint ticket was closed.

```{r}
## we are calculating the differnce of 'Closed Date' and 'Created Date' of an incidents and storing it into a new Column called 'Avg Date'.
nyc.df$Avg_Date = as.numeric(difftime(nyc.df$`Closed Date`, nyc.df$`Created Date`))
nyc.df$Avg_Date <- (nyc.df$Avg_Date/3600)
head(nyc.df)
```

We observed that many rows in closed date or created date were empty and hence our Avg date was showing NA or sometimes coming out to be negative (in some cases created date was greater than the closed date), so we considered the data where the difference of closed and created date was positive or in short the closed date was greater than the created date, so we took Avg date which is greater than 0. This way we got rid of unnecessary data that was not useful for our exploratory analysis.

```{r}
nyc.df <- nyc.df[nyc.df$Avg_Date>=0,]
```

### Here we calculated the mean average time it takes to close the complaint by Borough

```{r}
df_time_to_closure <- aggregate(nyc.df$Avg_Date, list(nyc.df$Borough), mean, na.action = NULL, na.rm = TRUE)
df_time_to_closure
```

### It can be seen here that the mean time (in hours) of incident closure is maximum in Staten Island.

```{r}
ggplot(df_time_to_closure, aes(x = reorder(df_time_to_closure$Group.1, -df_time_to_closure$x), y = df_time_to_closure$x)) +
         geom_bar(stat = "identity", fill="orange") + 
         xlab("Borough") + ylab("Complaint average closure time(hours)")
```

The below boxplot shows the minimum, first quartile, median, third quartile and maximum time (in hours) it is taken by every borough to solve the complaints. So it can be seen the median time of closure for QUEENS is minimum. We discussed about how QUEENS has a lot of problems. But looks like their problem resolution time is comparitively faster than other Boroughs. The number of complaints take lesser time to resolve and problems in Manhattan never gets resolved. So as we hypothesized earlier about Manhattans law and order being efficient, looks like we were wrong! And our second hypothesis about Manhattan being a smaller Borough can be well justified from this boxplot atleast. Staten Island still does a great job in this department. For all the boroughs, Box-plot is rightly skewed which means that the mean is greater than the median or average time of closure of complaint for all the Boroughs are greater than the median of the complaints.

```{r}
boxplot(nyc.df$Avg_Date ~ nyc.df$Borough, nyc.df, ylim=c(0,800), col = "pink", par(cex.axis=0.70))
```

# NYPD collision dataset

## Installing and Loading Important Packages

```{r, include=FALSE}
# Load all the packages

# Reference
# http://www.vikram-baliga.com/blog/2015/7/19/a-hassle-free-way-to-verify-that-r-packages-are-installed-and-loaded
packages = c("knitr","data.table","tidyverse","dataMeta","ggrepel","tidyverse","wordcloud", "dplyr", "tidyr", "RColorBrewer", "cowplot", "mice", "VIM", "ggthemes", "kableExtra", "ggthemes")

#use this function to check if each package is on the local machine
#if a package is installed, it will be loaded
#if any are not, the missing package(s) will be installed and loaded
package.check <- lapply(packages, FUN = function(x) {
    if (!require(x, character.only = TRUE)) {
        install.packages(x, dependencies = TRUE)
        library(x, character.only = TRUE)
    }
})
#verify they are loaded
search()
```

## Data loading, cleaning and transformation for analysis

### Loading the CSV file data-frame

```{r}
nyccols.df <- fread(file="./NYPD_Motor_Vehicle_Collisions.csv", na.strings=c("","NA"), header=TRUE, sep=",")
```

### Finding missing values in the data

```{r}
nyccols.df %>% select(everything()) %>% summarise_all(funs(sum(is.na(.))))
```

As we can see how an important attribute like BOROUGH has so many missing values. We have 2 options, either to impute the values to safe-guard loss of knowledge or just remove the rows. We will go by removing the rows in the subsequent sections.

### Data Summary

```{r}
kable(head(nyccols.df[, 1:9]), "latex", booktabs = T) %>%
  kable_styling(latex_options = c("striped", "scale_down", "HOLD_position"))
kable(head(nyccols.df[, 10:18]), "latex", booktabs = T) %>%
  kable_styling(latex_options = c("striped", "scale_down", "HOLD_position"))
kable(head(nyccols.df[, 19:29]), "latex", booktabs = T) %>%
  kable_styling(latex_options = c("striped", "scale_down", "HOLD_position"))
```

### Creating proper headings of columns.

```{r}
names(nyccols.df) <- str_replace_all(names(nyccols.df), c(" " = "." , "," = ""))
colnames(nyccols.df)
```


We can see how column names now have dots in place. This way columns are now more accessible. We can also see from the columns, either people are getting injured or killed as a result of the collisions. We need to consolidate them by some means. We will do that in the subsequent sections.


### Lets first summarize column namely "BOROUGH"

```{r}
summary(nyccols.df$BOROUGH)
```

We see that "BOROUGH" has a class that is character, whereas a "BOROUGH" is supposed to be a factor. So converting "BOROUGH" to factor.

### Converting Borough to Factors. 

```{r}
nyccols.df$BOROUGH <- as.factor(nyccols.df$BOROUGH)
unique(nyccols.df$BOROUGH)
summary(nyccols.df$BOROUGH)
```
\hfill\break
We can now see the "BOROUGH" has been converted to factor. Which has 6 values: BRONX, BROOKLYN, MANHATTAN, QUEENS, STATEN ISLAND, NA's. As we can see NA's This means we have to remove the NA value from the "BOROUGH" column. This is done here-under:  
```{r}
nyccols.df <- nyccols.df[!is.na(nyccols.df$BOROUGH), ]
unique(nyccols.df$BOROUGH)
```
\hfill\break
We can now see there are only 5 unique BOROUGHS. The NA values have been removed.

### Summarizing and improving "DATE" column

```{r}
summary(nyccols.df$DATE)
```
\hfill\break
We can see the "DATE " column is not in its proper format. It has a character class. Which is not correct for a date to have. If we want to do some kind of analysis that involves date we need to have it in the correct format. Therefore in the next line we are converting "DATE" into its proper format. 

```{r}
nyccols.df$DATE <- as.Date(nyccols.df$DATE, "%m/%d/%Y")
summary(nyccols.df$DATE)
```
\hfill\break
Date is now in its proper format!

### Lets re-arrange data, by columns properly. 

Unique Key should be the first column. So lets do that:

```{r}
colnames(nyccols.df)
```
\hfill\break
We can see the column names from the above. Let arrange them using the dplyr package.

```{r}
nyccols.df = nyccols.df %>% select("UNIQUE.KEY","BOROUGH","DATE","TIME","ZIP.CODE","LATITUDE","LONGITUDE","LOCATION","ON.STREET.NAME","CROSS.STREET.NAME","OFF.STREET.NAME","NUMBER.OF.PERSONS.INJURED","NUMBER.OF.PERSONS.KILLED","NUMBER.OF.PEDESTRIANS.INJURED","NUMBER.OF.PEDESTRIANS.KILLED","NUMBER.OF.CYCLIST.INJURED","NUMBER.OF.CYCLIST.KILLED","NUMBER.OF.MOTORIST.INJURED","NUMBER.OF.MOTORIST.KILLED","CONTRIBUTING.FACTOR.VEHICLE.1","CONTRIBUTING.FACTOR.VEHICLE.2","CONTRIBUTING.FACTOR.VEHICLE.3","CONTRIBUTING.FACTOR.VEHICLE.4","CONTRIBUTING.FACTOR.VEHICLE.5","VEHICLE.TYPE.CODE.1","VEHICLE.TYPE.CODE.2","VEHICLE.TYPE.CODE.3","VEHICLE.TYPE.CODE.4","VEHICLE.TYPE.CODE.5")
```

```{r}
colnames(nyccols.df)
```
\hfill\break
We can see now the columnNames are in accordance to what we require.

## Data Analysis

### Making a location Data-frame

This will make it easy for exploratory data analysis. Aggregating BOROUGH, ZIP.CODE, LATITUDE, LONGITUDE, LOCATION.

```{r}
loc_df <- nyccols.df[, c(2, 5, 6, 7, 8)]
kable(head(loc_df), "latex", booktabs = T, caption="Location data-frame") %>%
  kable_styling(latex_options = c("striped", "HOLD_position", "scale_down"))
```


### Some analysis. Lets Consolidate how many people got injured. 

NUMBER.OF.PERSONS.INJURED, NUMBER.OF.PEDESTRIANS.INJURED, NUMBER.OF.CYCLIST.INJURED, NUMBER.OF.MOTORIST.INJURED aggregating these columns will be aggregated to form one data-frame for easy access and manipulation. 

```{r}
# Getting all the columns and saving it in a data frame namely injured
injured <- nyccols.df[,c(12, 14, 16, 18)]
kable(head(injured), "latex", booktabs = T, caption = "Injured data-frame") %>%
  kable_styling(latex_options = c("striped", "HOLD_position", "scale_down"))
```
\hfill\break
Now tell me, does it matter whether it was the cyclist who got injured or a motorist? Maybe from specifc data analysis point of view it may be of a great importance, but in general, its a person only who got injured. Lets now add up the numbers in these columns for each row. So for every row number of injured people will be Injured = NUMBER.OF.PERSONS.INJURED + NUMBER.OF.PEDESTRIANS.INJURED + NUMBER.OF.CYCLIST.INJURED + NUMBER.OF.MOTORIST.INJURED and similarly carry out for Killed.

### Finding total Injured and adding it to data frame

```{r}
injured$total <- rowSums(injured)
loc_df$INJURED <- injured$total
kable(head(loc_df), "latex", booktabs = T, caption = "Adding total injured to location data-frame") %>%
  kable_styling(latex_options = c("striped", "HOLD_position", "scale_down"))
```


### Lets Consolidate how many people got Killed Columns: 

We will be working on these columns: NUMBER.OF.PERSONS.KILLED, NUMBER.OF.PEDESTRIANS.KILLED, NUMBER.OF.CYCLIST.KILLED, NUMBER.OF.MOTORIST.KILLED. So for every row number of killed people will be:
killed = NUMBER.OF.PERSONS.KILLED + NUMBER.OF.PEDESTRIANS.KILLED + NUMBER.OF.CYCLIST.KILLED + NUMBER.OF.MOTORIST.KILLED and similarly carry out for Killed.

```{r}
# Getting all the columns and saving it in a data frame namely killed
killed <- nyccols.df[,c(13, 15, 17, 19)]
kable(head(killed), "latex", booktabs = T, caption = "Killed data-frame") %>%
  kable_styling(latex_options = c("striped", "HOLD_position", "scale_down"))
```

### Finding total Killed and adding it to data frame

```{r}
killed$total <- rowSums(killed)
loc_df$KILLED <- killed$total
kable(head(loc_df), "latex", booktabs = T, caption = "Adding total killed to location data-frame") %>%
  kable_styling(latex_options = c("striped", "HOLD_position", "scale_down"))
```

### Finding injuries by hour due to collisions

```{r}
injured$TIME <- nyccols.df$TIME
injured$HOUR <- hour(as.POSIXct(injured$TIME, format = "%H:%M"))
injured$BOROUGH <- nyccols.df$BOROUGH
kable(head(injured), "latex", booktabs = T, caption = "Injuries with respect to time in hours") %>%
  kable_styling(latex_options = c("striped", "HOLD_position", "scale_down"))
```


### Getting to find accidents by hour

```{r}
accident_by_hour <- injured %>% group_by(BOROUGH, HOUR) %>% summarise(Injured_people = sum(total))
accident_by_hour <- filter(accident_by_hour, BOROUGH != "")
kable(head(accident_by_hour), "latex", booktabs = T, caption = "Finding injury frequency over time") %>%
  kable_styling(latex_options = c("striped", "HOLD_position"))
```


```{r fig.align="center", fig.asp=0.8, fig.pos="H", fig.cap="People injured due to collision with time"}
ggplot(accident_by_hour, aes(HOUR, Injured_people, fill = BOROUGH)) +
  geom_bar(stat = "identity", show.legend = FALSE) + theme_calc() +
  ggtitle("People injured in collision according to time") +
  facet_grid(BOROUGH ~ .)
```

From above we can see a lot of injuries are happening to people due to collisions at around 8 AM till 8 PM (20:00 HRS). And there is a set pattern. All the BOROUGHS except BRONX show that the maxima is at 5 PM (17:00 HRS). Generally maxima is between 4 to 6 PM. This shows maximum injuries happen around this time. One speculation could be maybe because these are generally rush hour/office hours? Also, there is a spike at around 8 am as well. What does it tell? Generally people head to office during these hours. Why all this starts at around 2 PM? Looks like school hours!  School timings in the US are generally 8:30 AM till 3:30 PM! So this is the speculation.


### Finding how many people got killed by hour due to collisions

```{r}
killed$TIME <- nyccols.df$TIME
killed$HOUR <- hour(as.POSIXct(killed$TIME, format = "%H:%M"))
killed$BOROUGH <- nyccols.df$BOROUGH
kable(head(killed), "latex", booktabs = T, caption = "People killed with respect to time in hours") %>%
  kable_styling(latex_options = c("striped", "HOLD_position", "scale_down"))
```

### Getting to find accidents by hour

```{r}
accident_by_hour_killed <- killed %>% group_by(BOROUGH, HOUR) %>% summarise(killed_people = sum(total))
accident_by_hour_killed <- filter(accident_by_hour_killed, BOROUGH != "")
kable(head(accident_by_hour_killed), "latex", booktabs = T, caption = "Finding injury frequency over time") %>%
  kable_styling(latex_options = c("striped", "HOLD_position"))
```

```{r fig.align="center", fig.asp=0.8, fig.pos="H", fig.cap="People killed in collision with time"}
ggplot(accident_by_hour_killed, aes(HOUR, killed_people, fill = BOROUGH)) +
  geom_bar(stat = "identity", show.legend = FALSE) + theme_calc() +
  ggtitle("People killed in collision according to time") +
  facet_grid(BOROUGH ~ .)
```

There is not any set pattern as far a killings due to collisions are concerned. BROOKLYN is doing a really bad job! Maybe we can find out with further analysis of why is BROOKLYN doing so bad in this department.


### Top reasons for collisions

```{r}
reason_df <- loc_df
reason_df$Reason <- nyccols.df$CONTRIBUTING.FACTOR.VEHICLE.1
top10_reasons <- reason_df %>% group_by(Reason) %>% summarise(Total_accident = n()) %>% top_n(10, Total_accident)
top10_reasons <- top10_reasons[order(top10_reasons$Total_accident, decreasing = TRUE),]
kable(top10_reasons, "latex", booktabs = T, caption = "Top 10 collision reasons") %>%
  kable_styling(latex_options = c("striped", "HOLD_position"))
```

### Lets visualize it

```{r fig.align="center", fig.asp=0.8, fig.pos="H", fig.cap="Collision Reasons and their frequencies"}
ggplot(top10_reasons, aes(x = reorder(top10_reasons$Reason, -top10_reasons$Total_accident), y = top10_reasons$Total_accident)) +
         geom_bar(stat = "identity", fill="blue") +
         scale_y_continuous(labels=function(n){format(n, scientific = FALSE)}) +
         coord_flip() + 
         ylab("Frequency of Collision by Reason") + 
         xlab("Reasons")+ ggtitle("Collision Reasons Frequency")
```

So, most of the times its "Driver Inattention/Distraction", that is leading to collisions. There are 2 shocking discoveries in our data-set. These are "Prescription Medication" scores higher than "Alcohol Involvement" and "Alcohol Involvement" surprisingly is not one of the top contender as always thought!

### Contributing Vehicles to injuries

```{r}
contri_vehicle <- loc_df[,c("BOROUGH", "INJURED")]
contri_vehicle$TYPE <- nyccols.df$VEHICLE.TYPE.CODE.1
top10_vehicle_types <- contri_vehicle %>% group_by(TYPE) %>% 
  summarise(INJURED = sum(INJURED)) %>% 
    top_n(10, INJURED)
top10_vehicle_types <- top10_vehicle_types[-c(1,4),]
top10_vehicle_types <- top10_vehicle_types[order(top10_vehicle_types$INJURED, decreasing = T),]
top10_vehicle_types <- top10_vehicle_types[-c(5, 10) , ]
top10_vehicle_types <- top10_vehicle_types[1:10, ]
kable(top10_vehicle_types, "latex", booktabs = T, caption = "Top 10 Vehicles Leading to Injuries") %>%
  kable_styling(latex_options = c("striped", "HOLD_position"))
```

### Lets visualize it

```{r fig.align="center", fig.asp=0.8, fig.pos="H", fig.cap="Top 10 Vehicles Causing Injuries"}
ggplot(top10_vehicle_types, aes(x = reorder(top10_vehicle_types$TYPE, -top10_vehicle_types$INJURED), y = top10_vehicle_types$INJURED)) +
         geom_bar(stat = "identity", fill="blue") +
         scale_y_continuous(labels=function(n){format(n, scientific = FALSE)}) +
         coord_flip() + ylab("Injury count") + 
         xlab("Contributing Vehicles") + 
         ggtitle("Vehicles Causing Injuries")
```

This shows that passenger vehicles are mostly involved in injuring people. Next SUVs, then TAXI and so on so forth!


### Top 10 contributing vehicles to Killings

```{r}
contri_vehicle_killed <- loc_df[,c("BOROUGH", "KILLED")]
contri_vehicle_killed$TYPE <- nyccols.df$VEHICLE.TYPE.CODE.1
top10_vehicle_types_killed <- contri_vehicle_killed %>% 
  group_by(TYPE) %>% 
  summarise(KILLED = sum(KILLED)) %>% top_n(20, KILLED)
top10_vehicle_types_killed <- top10_vehicle_types_killed[-c(1,4),]
top10_vehicle_types_killed <- top10_vehicle_types_killed[order(top10_vehicle_types_killed$KILLED, decreasing = T),]
top10_vehicle_types_killed <- top10_vehicle_types_killed[-c(5, 9), ]
top10_vehicle_types_killed <- top10_vehicle_types_killed[1:10,]
kable(top10_vehicle_types_killed, "latex", booktabs = T, caption = "Top 10 Contributing Vehicles Leading To Killings") %>%
  kable_styling(latex_options = c("striped", "HOLD_position"))
```

### Lets visualize it
```{r fig.align="center", fig.asp=0.8, fig.pos="H", fig.cap="Top 10 Vehicles Causing Killings"}
ggplot(top10_vehicle_types_killed, aes(x = reorder(top10_vehicle_types_killed$TYPE, -top10_vehicle_types_killed$KILLED), y = top10_vehicle_types_killed$KILLED)) +
         geom_bar(stat = "identity", fill="blue") +
         scale_y_continuous(labels=function(n){format(n, scientific = FALSE)}) +
         coord_flip() + ylab("Killings Count") + 
         xlab("Contributing Vehicles") + ggtitle("Vehicles causing Killings") + 
         theme(plot.title = element_text(hjust = 0.5))
```

Passenger Vehicle is as bad for killings as it is for injuries. So is SUV. Surprisingly Motorcycle? Is it the person riding Motorcycle got killed or did the motorcycle killed the person it collided with? My speculation is, its collision of a person on Motorcycle whether being hit by or did hit leads to a person being killed. Motorcycles are dangerous!

# Data Dictionary
## Creating Data dictionary for NYC 311

```{r}
Row <- c(1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52)
Variable.Names <- c('Address Type','Agency','Agency Name','Borough','Bridge Highway Direction','Bridge Highway Name','Bridge Highway Segment','City','Closed Date','Community Board','Complaint Type','Created Date','Cross Street 1','Cross Street 2','Descriptor','Due Date','Facility Type','Ferry Direction','Ferry Terminal Name','Garage Lot Name','Incident Address','Incident Zip','Intersection Street 1','Intersection Street 2','Landmark','Latitude','Location','Location Type','Longitude','Park Borough','Park Facility Name','Resolution Action Updated Date','Road Ramp','School Address','School City','School Code','School Name','School Not Found','School Number','School or Citywide Complaint','School Phone Number','School Region','School State','School Zip','Status','Street Name','Taxi Company Borough','Taxi Pick Up Location','Unique Key','Vehicle Type','X Coordinate (State Plane)','Y Coordinate (State Plane)')

Variable.Description <- c("Type of address, it includes just 5 entries Address, BlockFace, Intersection, Latlong, PlaceName or Blank","Goverenment agency of the city where incident was reported. Some of the agency consist of dates which might not be useful.","Full name of the Goverment Agency. Instead of full name of the agency some of the rows contain dates","This is provided by the submitter and validated by geovalidation","The direction of the highway where the incident occured","If the incident occured in bridge highway, the name will be dsplayed","Additional information on the bridge highway","City where the incident occured","Date when the incident was closed","This is provided by the geovalidation","The brief description of incident or complaint","The date when the incident was created","First cross street from the given street","Second cross street from the given address","Descriptor further explains the complaint type in detail","The date when the agency is supposed to provide the status based on the type of complaint and its SLA.","Type of facility associated to the request. There are 4 facility type which are Precint,School dist, School, DSNY Garage","Direction of the ferry if the incident occured in ferry","Name og the ferry terminal","Name of the garage lot","House number provided by the submitter","Zip code where the incident occured. Zip code is  either 4 digit, 5 digit or 9 digit with a - between 5th and 6th digit or sometimes NA ","First intersection street from the street where the incident occured","Second intersection street from the street where the incident occured","If the incident occured in some important Landmark, so the name of the landmark is provided","Geo based Latitude where the incident occured","Combination of Latitude and Longitude","Type of Location given in the address","Geo based longitude where the incident occured","Borough of the incident if it is Park Dept facility","The name of the park dept facility","Date when the agency last updated the request"," This will describe if the incident occured in road or ramp or if it is bridge highway issue","Exact address of the school where incident occured","City of the school as confirmed by geovalidation","Unique code given to the school of incident","Name of the school if the incident occured in school","Flag whether the school was found or not contains value Yes or No","Number of the school","Complaint of a school or the entire city. This column is blank for all the rows.","Phone number of the school where incident occured","Location of the school contains value from Region 1 to Region 9 and alternative superintendency","State of the school given by the submitter and validated by the geovalidation","School's city zipcode","Status of the incident.","Street name where the incident occured","If the incident is taxt, this field will describe the borogh of the taxi company ","Pick up location of taxi, if the incident is taxi. Location is either airport, station, bus terminal or Intersection","It uniquely identifies the request or complaints","Type of vehicle in which the incident occured contains the value Car Service, Green Taxi, Ambullet/Paratransit, Commuter Van","X-coordinate where the incident occured","Y- coordinate where the incident occured")

Variable.Options <- c("ADDRESS,INTERSECTION,NA,LATLONG,BLOCKFACE,PLACENAME", "NYPD,TLC,DPR,DOT,CHALL,DOHMH,EDC,DCA,HRA,DSNY,HPD,DEP,FDNY,DHS,DOF,DOE,DOB,DOITT,MOIA,3/1/2001,DFTA", "311 Executive Office - EC to Taxi and Limousine Commission", "BRONX,BROOKLYN,MANHATTAN,QUEENS,STATEN ISLAND,Unspecified", "Mostly Empty Values", "Mostly Empty Values", "Mostly Empty Values", "Mostly Empty Values", "Mostly Empty Values", "10 BRONX,18 BROOKLYN,11 BROOKLYN,01 BROOKLYN,07 MANHATTAN,02 BROOKLYN,05 QUEENS,09 BROOKLYN,04 MANHATTAN,08 BROOKLYN,03 STATEN ISLAND,15 BROOKLYN,11 QUEENS,Unspecified MANHATTAN,03 MANHATTAN,05 MANHATTAN,0 Unspecified,09 QUEENS,03 QUEENS,Unspecified BROOKLYN,14 QUEENS,12 BROOKLYN,05 BROOKLYN,04 BRONX,09 MANHATTAN,11 BRONX,02 QUEENS,12 MANHATTAN,07 QUEENS,10 MANHATTAN,Unspecified BRONX,09 BRONX,03 BROOKLYN,12 BRONX,01 QUEENS,Unspecified QUEENS,10 QUEENS,07 BROOKLYN,02 MANHATTAN,05 BRONX,17 BROOKLYN,11 MANHATTAN,01 STATEN ISLAND,07 BRONX,12 QUEENS,06 MANHATTAN,13 QUEENS,04 BROOKLYN,10 BROOKLYN,01 MANHATTAN,08 MANHATTAN,04 QUEENS,06 BROOKLYN,08 QUEENS,08 BRONX,13 BROOKLYN,14 BROOKLYN,16 BROOKLYN,06 QUEENS,06 BRONX,01 BRONX,02 STATEN ISLAND,Unspecified STATEN ISLAND,03 BRONX,02 BRONX,81 QUEENS,83 QUEENS,27 BRONX", "Agency Issues to Window Guard", "04/11/2015 07:48:56 PM to 04/14/2015 12:59:47 AM
", "Mostly Empty", "Mostly Empty", "1 Missed Collection to Zoning - Non-Conforming/Illegal Vehicle Storage
", "Mostly Empty", "Precinct,N/A,NA,DSNY Garage,School", "Mostly Empty",  "Mostly Empty",  "Mostly Empty",  "Mostly Empty",  "Mostly Empty",  "Mostly Empty",  "Mostly Empty",  "Mostly Empty",  "Mostly Empty",  "Mostly Empty",  "Mostly Empty",  "Mostly Empty", "BRONX to Unspecified", "Alice Kornegay to Willow Lake Playground - PS 197
", "Mostly Empty", "Mostly Empty", "110th Street and Lenox Avenue to Yellowstone Boulevard, 65th Road, 65th Avenue
", "ASTORIA to Unspecified", "Mostly Empty", "Alice Kornegay to Willow Lake Playground - PS 197", "Mostly Empty", "178 to X257", "Mostly Empty", "2122190258 to Unspecified", "Mostly Empty", "NY to Unspecified", "10002 to Unspecified", "Assigned to Unassigned", "Mostly Empty", "Mostly Empty", "Mostly Empty","30377353 to 30395290", "Mostly Empty", "Mostly Empty", "Mostly Empty")

Variable.Type <- c("char","char","char","char","char","char","char","char","char","char","char","char","char","char","char","char","char","char","char","char","char","char","char","char","char","dbl","char","char","dbl","char","char","char","char","char","char","char","char","char","char","char","char","char","char","char","char","char","char","int","char","char","int","int")
dict_df <- data.frame(Row, Variable.Names, Variable.Description, Variable.Options, Variable.Type)

kable(dict_df , "latex", booktabs = T, caption = "NYC 311") %>%
  kable_styling(latex_options = c("striped", "HOLD_position", "scale_down"))
```

## Creating Data dictionary for NYPD Motor Vehicle Collision

```{r}
# Data Dictionary
Row <- c(1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29)

Variable.Names <- c('Borough', 'Contributing Factor Vehicle 1', 'Contributing Factor Vehicle 2', 'Contributing Factor Vehicle 3', 'Contributing Factor Vehicle 4', 'Contributing Factor Vehicle 5', 'Cross Street Name', 'Date', 'Latitude', 'Location', 'Longitude', 'Number of Cyclist Injured', 'Number of Cyclist Killed', 'Number of Motorist Injured', 'Number of Motorist Killed', 'Number of Pedestrians Injured', 'Number of Pedestrians Killed', '	Number of Persons Injured', 'Number of Persons Killed', 'Off Street Name', 'On Street Name', 'Time', 'Unique Key', 'Vehicle Type Code 1', 'Vehicle Type Code 2', 'Vehicle Type Code 3', 'Vehicle Type Code 4', 'Vehicle Type Code 5', 'Zip Code' )

Variable.Description <- c("Borough in which the incident occured", "There are 60 unique contributing factor causing the incident", "This gaves the further description of the contributing factor, but is mostly empty", "3rd contributing factor", "4th contributing factor", "5th contributing factor", "Name of the cross street", "Date of the incident", "Latitude of the incident","Location of the incident", "Longitude of the incident", "Cyclist injured", "Exact number of the cyclist killed", "Count of Motorist injured in an incident", "Count of Motorist killed in an incident", "Count of Pedestrian injured in an incident", "Count of Pedestrian killed in an incident", "Count of Persons injured in an incident", "Count of Persons killed in an incident", "Nameof the off street", "Name of the street incident occured","Time of the incident occurence", "Key identifying each record uniquely", "Type of the vehicle", "Further description of vehicle", "Description of vehicle 3", "Description of vehicle 4", "Decsription of vehicle 5", "Zip code of the location where incident occured" )

Variable.Options <- c("Borough contain 6 entries Staten Island, Brooklyn, Bronx, Queens, Manhattan and NA","Mostly contains Empty values", "Mostly contains Empty value", "Mostly contains Empty value", "Some rows are filled some are empty", "Mostly filled", "", "", "Few entries contain NA in Latitude", "Few entries contain NA in Location", "Few entries contain NA in Longitude", "Entries contain value from 0,1,2,3,4 and a weird value [1]", "Entries contain value from 0,1,2 and a weird value [1]", "Max value is 43", "Entries contain value 0,1,2,3,4,5", "Max value is 27", "Entries contain value 0,1,2,6", "Max value is 43", "Max value is 8", "Mostly Empty", "", "", "& digit unique number", "At some places the value is Contain NA,N/A or UNKNOWN", "Few NA", "Mostly Empty", "Mostly Empty", "Mostly Empty", "Its a 5 digit number")

Variable.Type <- c("char", "char", "char", "char", "char", "char", "char", "char", "dbl","char", "dbl", "int", "int", "int", "int", "int", "int", "int", "int", "char", "char", "char", "int", "char", "char", "char", "char", "char", "int")
dict_df <- data.frame(Row, Variable.Names, Variable.Description, Variable.Options, Variable.Type)

kable(dict_df , "latex", booktabs = T, caption = "Motor-vehicle Collision dataset") %>%
  kable_styling(latex_options = c("striped", "HOLD_position", "scale_down"))
```
